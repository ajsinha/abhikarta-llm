{% extends "help/help_base.html" %}

{% set title = "Core Features" %}
{% set description = "Explore the key capabilities of Abhikarta-LLM" %}
{% set icon = "bi-stars" %}
{% set header_color = "#0d6efd" %}
{% set header_color_dark = "#0a58ca" %}

{% block help_nav %}
<a href="#workflow-dags">Workflow DAGs</a>
<a href="#code-fragments">Code Fragments</a>
<a href="#tools-system">Tools System</a>
<a href="#tool-framework">Tool Framework</a>
<a href="#template-libraries">Template Libraries</a>
<a href="#python-script-mode">Python Script Mode</a>
<a href="#llm-management">LLM Management</a>
<a href="#hitl">Human-in-the-Loop</a>
<a href="#ai-organizations">AI Organizations</a>
<a href="#notifications">Notifications</a>
<a href="#mcp-plugins">MCP Plugins</a>
<a href="#rbac">Enterprise RBAC</a>
{% endblock %}

{% block help_content %}
<h2 id="workflow-dags">Workflow DAG Execution</h2>
<div class="row align-items-center mb-5">
    <div class="col-lg-6">
        <p class="lead">Define complex multi-step workflows as Directed Acyclic Graphs with embedded Python modules.</p>
        <ul>
            <li>12+ node types: LLM, Python, HTTP, Condition, Loop, Parallel, HITL</li>
            <li>Visual workflow editor</li>
            <li>JSON-based workflow definitions</li>
            <li>Reusable Python modules (inline or via URI)</li>
            <li><strong>Code Fragments:</strong> Load code from <code>db://</code>, <code>file://</code>, or <code>s3://</code></li>
            <li>Dependency management</li>
            <li>Error handling and retry logic</li>
        </ul>
    </div>
    <div class="col-lg-6">
        <pre><code class="language-json">{
  "workflow_id": "data-pipeline",
  "python_modules": {
    "utils": "db://data-utils"
  },
  "nodes": {
    "input": {"type": "input"},
    "process": {
      "type": "python",
      "dependencies": ["input"],
      "code": "from utils import transform\noutput = transform(input_data)"
    },
    "analyze": {
      "type": "llm",
      "dependencies": ["process"],
      "config": {"model": "gpt-4o"}
    }
  }
}</code></pre>
    </div>
</div>

<hr class="my-5">

<h2 id="code-fragments">Code Fragments</h2>
<div class="row align-items-center mb-5">
    <div class="col-lg-6 order-lg-2">
        <p class="lead">Manage reusable code modules that can be loaded at runtime from multiple sources.</p>
        <ul>
            <li><code>db://</code> - Database-managed fragments with versioning</li>
            <li><code>file://</code> - Local filesystem for development</li>
            <li><code>s3://</code> - AWS S3 for enterprise deployments</li>
            <li>Admin UI for creating and editing fragments</li>
            <li>Usage tracking and version history</li>
            <li>Categories and tags for organization</li>
        </ul>
    </div>
    <div class="col-lg-6 order-lg-1">
        <pre><code class="language-json">{
  "python_modules": {
    "data_utils": "db://data-utils",
    "csv_parser": "db://csv-parser",
    "custom": "file:///opt/code/custom.py",
    "enterprise": "s3://bucket/utils.py"
  }
}</code></pre>
    </div>
</div>

<hr class="my-5">

<h2 id="tools-system">Tools System <span class="badge bg-success">v1.1.6</span></h2>
<div class="row align-items-center mb-5">
    <div class="col-lg-6">
        <p class="lead">Unified tool architecture with centralized registry and multiple tool types.</p>
        <ul>
            <li><strong>BaseTool:</strong> Abstract base class for all tool implementations</li>
            <li><strong>FunctionTool:</strong> Wrap Python functions with @tool decorator</li>
            <li><strong>MCPTool:</strong> Automatically wrap MCP server tools</li>
            <li><strong>HTTPTool:</strong> Call REST APIs as tools</li>
            <li><strong>CodeFragmentTool:</strong> Execute database-stored code</li>
            <li><strong>ToolsRegistry:</strong> Centralized registration and discovery</li>
            <li>Format conversion: OpenAI, Anthropic, LangChain</li>
        </ul>
    </div>
    <div class="col-lg-6">
        <pre><code class="language-python">from abhikarta.tools import tool, get_tools_registry

@tool(name="calculate", description="Calculate expression")
def calculate(expression: str) -> float:
    return eval(expression)

# Register and use
registry = get_tools_registry()
result = registry.execute("calculate", expression="2+2")
# result.output = 4

# Convert for LLM
openai_funcs = registry.to_openai_functions()</code></pre>
    </div>
</div>

<hr class="my-5">

<h2 id="tool-framework">Tool Framework <span class="badge bg-success">v1.3.0</span></h2>
<div class="row align-items-center mb-5">
    <div class="col-lg-6 order-lg-2">
        <p class="lead">Extensible tool infrastructure with 10 base tool types.</p>
        <ul>
            <li><strong>BaseTool:</strong> Abstract base class for all tools</li>
            <li><strong>FunctionTool:</strong> Wrap Python functions as tools</li>
            <li><strong>HTTPTool:</strong> Make HTTP/REST API calls</li>
            <li><strong>MCPTool:</strong> Connect to MCP tool servers</li>
            <li><strong>CodeFragmentTool:</strong> Execute code fragments (db://, file://, s3://)</li>
            <li><strong>LangChainTool:</strong> Integrate LangChain tools</li>
            <li>Automatic schema generation</li>
            <li>Compatible with all LLM providers</li>
        </ul>
        <a href="{{ url_for('help_page', page='prebuilt-tools') }}" class="btn btn-outline-primary">View Tool Framework →</a>
    </div>
    <div class="col-lg-6 order-lg-1">
        <pre><code class="language-python"># Create custom tools easily
from abhikarta.tools import tool

@tool(name="calculate_tax", 
      description="Calculate tax amount")
def calculate_tax(amount: float, rate: float) -> float:
    return amount * (rate / 100)

# Or use the class-based approach
class MyCustomTool(BaseTool):
    def execute(self, **kwargs) -> ToolResult:
        # Your logic here
        return ToolResult(success=True, output=result)</code></pre>
    </div>
</div>

<hr class="my-5">

<h2 id="template-libraries">Template Libraries <span class="badge bg-success">v1.4.8.1</span></h2>
<div class="row align-items-center mb-5">
    <div class="col-lg-6">
        <p class="lead">44 ready-to-use templates for rapid deployment.</p>
        <h6>Agent Templates (13)</h6>
        <ul class="list-unstyled">
            <li><i class="bi bi-robot text-primary me-2"></i><strong>Research & Analysis:</strong> Research Agent, Data Analysis Agent</li>
            <li><i class="bi bi-code-slash text-info me-2"></i><strong>Development:</strong> Code Generation Agent, Task Decomposition Agent</li>
            <li><i class="bi bi-lightbulb text-warning me-2"></i><strong>Creative:</strong> Creative Writing Agent, Summarization Agent</li>
            <li><i class="bi bi-chat text-success me-2"></i><strong>Interactive:</strong> Socratic Tutor, Decision Support Agent</li>
        </ul>
        <h6>Workflow Templates (22)</h6>
        <ul class="list-unstyled">
            <li><i class="bi bi-diagram-3 text-primary me-2"></i><strong>Sequential & Parallel:</strong> Multi-stage pipelines</li>
            <li><i class="bi bi-signpost-split text-info me-2"></i><strong>Conditional & Iterative:</strong> Branching logic</li>
            <li><i class="bi bi-person-check text-success me-2"></i><strong>HITL Patterns:</strong> Human approval workflows</li>
            <li><i class="bi bi-exclamation-triangle text-danger me-2"></i><strong>Error Handling:</strong> Retry and recovery</li>
        </ul>
        <h6>Swarm Templates (5) + AI Org Templates (5)</h6>
        <ul class="list-unstyled">
            <li><i class="bi bi-hive text-warning me-2"></i>Multi-agent coordination patterns</li>
            <li><i class="bi bi-building text-primary me-2"></i>Hierarchical organization structures</li>
        </ul>
    </div>
    <div class="col-lg-6">
        <div class="card border-primary">
            <div class="card-header bg-primary text-white">Code Fragment URIs</div>
            <div class="card-body">
                <p>Templates reference code using URI schemes:</p>
                <pre><code class="language-json">{
  "code_fragments": [
    "db://code_fragments/data_validator",
    "s3://ml-models/fraud_detector.py",
    "file:///opt/fragments/custom.py"
  ],
  "workflow": {
    "nodes": [
      {
        "node_id": "validate",
        "node_type": "code_fragment",
        "config": {
          "fragment_uri": "db://code_fragments/data_validator"
        }
      }
    ]
  }
}</code></pre>
            </div>
        </div>
    </div>
</div>

<hr class="my-5">

<h2 id="python-script-mode">Python Script Mode <span class="badge bg-danger">v1.4.8 NEW</span></h2>
<div class="row align-items-center mb-5">
    <div class="col-lg-6">
        <p class="lead">For power users: Create agents, workflows, swarms, and AI orgs using pure Python code.</p>
        <h6>Supported Entity Types</h6>
        <ul class="list-unstyled">
            <li><i class="bi bi-robot text-primary me-2"></i><strong>Agents:</strong> Full control over agent logic</li>
            <li><i class="bi bi-diagram-3 text-info me-2"></i><strong>Workflows:</strong> Complex DAG definitions</li>
            <li><i class="bi bi-hive text-warning me-2"></i><strong>Swarms:</strong> Multi-agent orchestration</li>
            <li><i class="bi bi-building text-success me-2"></i><strong>AI Organizations:</strong> Hierarchical structures</li>
        </ul>
        <h6>Key Features</h6>
        <ul class="list-unstyled">
            <li><i class="bi bi-check-circle text-success me-2"></i>Code in your favorite IDE</li>
            <li><i class="bi bi-check-circle text-success me-2"></i>Upload/paste Python scripts via UI</li>
            <li><i class="bi bi-check-circle text-success me-2"></i>Validate before saving</li>
            <li><i class="bi bi-check-circle text-success me-2"></i>Execute directly from UI</li>
            <li><i class="bi bi-check-circle text-success me-2"></i>Version control friendly</li>
        </ul>
        <a href="{{ url_for('help_page', page='python-script-mode') }}" class="btn btn-outline-danger">Learn Python Script Mode →</a>
    </div>
    <div class="col-lg-6">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">Example: Python Agent Script</div>
            <div class="card-body">
<pre><code class="language-python"># my_research_agent.py
from abhikarta.agent import AgentDefinition
from abhikarta.tools import tool

@tool(name="search_arxiv")
def search_arxiv(query: str) -> dict:
    # Your custom search logic
    return {"results": [...]}

# Define agent using SDK
agent = AgentDefinition(
    name="Research Agent",
    description="Searches academic papers",
    agent_type="react",
    tools=["search_arxiv", "web_search"],
    llm_config={
        "provider": "ollama",
        "model": "llama3.2:3b"
    }
)

# This will be saved when uploaded
__export__ = agent</code></pre>
            </div>
        </div>
    </div>
</div>

<hr class="my-5">

<h2 id="llm-management">LLM Provider & Model Management <span class="badge bg-success">v1.1.0</span></h2>
<div class="row align-items-center mb-5">
    <div class="col-lg-6">
        <p class="lead">Centralized management of LLM providers and models with role-based access control.</p>
        <ul>
            <li>Configure 11+ LLM providers (OpenAI, Anthropic, Google, etc.)</li>
            <li>Define models with costs, context limits, and capabilities</li>
            <li>Role-based model access permissions</li>
            <li>Daily and monthly usage limits per role</li>
            <li>Pre-configured with 15+ popular models</li>
            <li>Admin UI for all management tasks</li>
        </ul>
    </div>
    <div class="col-lg-6">
        <pre><code class="language-sql">-- Model Permissions Example
SELECT m.display_name, r.display_name as role,
       mp.can_use, mp.daily_limit, mp.monthly_limit
FROM model_permissions mp
JOIN llm_models m ON mp.model_id = m.model_id
JOIN roles r ON mp.role_name = r.role_name
WHERE m.model_id = 'gpt-4o';

-- Result:
-- GPT-4o | Super Admin     | 1 | -1  | -1
-- GPT-4o | Agent Developer | 1 | 100 | 3000
-- GPT-4o | Agent User      | 1 | 50  | 1000</code></pre>
    </div>
</div>

<hr class="my-5">

<h2 id="llm-logging">Complete LLM Activity Logging</h2>
<div class="row align-items-center mb-5">
    <div class="col-lg-6 order-lg-2">
        <p class="lead">Every LLM interaction is automatically logged with full detail.</p>
        <ul>
            <li>Prompts and responses</li>
            <li>Token counts (input/output)</li>
            <li>Cost estimation per call</li>
            <li>Latency tracking</li>
            <li>Provider and model info</li>
            <li>Link to parent execution</li>
        </ul>
    </div>
    <div class="col-lg-6 order-lg-1">
        <pre><code class="language-sql">SELECT provider, model,
       COUNT(*) as calls,
       SUM(total_tokens) as tokens,
       SUM(cost_estimate) as cost
FROM llm_calls
WHERE created_at > datetime('now', '-7 days')
GROUP BY provider, model;</code></pre>
    </div>
</div>

<hr class="my-5">

<h2 id="hitl">Human-in-the-Loop (HITL)</h2>
<div class="row align-items-center mb-5">
    <div class="col-lg-6">
        <p class="lead">Add human oversight and approval checkpoints to ensure quality and safety.</p>
        <ul>
            <li>Multiple trigger types: keyword, confidence, cost, scheduled</li>
            <li>Task assignment and routing</li>
            <li>Approval/Rejection/Modification flows</li>
            <li>Escalation rules</li>
            <li>SLA tracking</li>
            <li>Audit trail</li>
        </ul>
    </div>
    <div class="col-lg-6">
        <pre><code class="language-json">{
  "type": "hitl",
  "config": {
    "task_type": "approval",
    "title": "Review AI Response",
    "assignee_roles": ["hitl_reviewer"],
    "timeout_hours": 24,
    "escalation": {
      "after_hours": 12,
      "escalate_to": "domain_admin"
    }
  }
}</code></pre>
    </div>
</div>

<hr class="my-5">

<h2 id="mcp-plugins">MCP Plugin System</h2>
<div class="row align-items-center mb-5">
    <div class="col-lg-6 order-lg-2">
        <p class="lead">Extend agent capabilities with Model Context Protocol plugins.</p>
        <ul>
            <li>HTTP/SSE remote plugins</li>
            <li>STDIO local plugins</li>
            <li>Dynamic tool discovery</li>
            <li>FastMCP Python framework</li>
            <li>Secure credential management</li>
        </ul>
    </div>
    <div class="col-lg-6 order-lg-1">
        <pre><code class="language-python">from fastmcp import FastMCP

mcp = FastMCP("My Tools")

@mcp.tool()
def search_database(query: str) -> str:
    """Search internal database"""
    results = db.search(query)
    return format_results(results)</code></pre>
    </div>
</div>

<hr class="my-5">

<h2 id="rbac">Enterprise RBAC</h2>
<div class="row align-items-center mb-5">
    <div class="col-lg-6">
        <p class="lead">Fine-grained role-based access control for enterprise deployments.</p>
        <ul>
            <li>7 predefined roles</li>
            <li>Custom role creation</li>
            <li>Resource-level permissions</li>
            <li>Domain/scope restrictions</li>
            <li>Audit logging</li>
        </ul>
    </div>
    <div class="col-lg-6">
        <div class="d-flex flex-wrap gap-2">
            <span class="badge bg-danger fs-6">super_admin</span>
            <span class="badge bg-warning text-dark fs-6">domain_admin</span>
            <span class="badge bg-primary fs-6">agent_developer</span>
            <span class="badge bg-info fs-6">agent_publisher</span>
            <span class="badge bg-success fs-6">hitl_reviewer</span>
            <span class="badge bg-secondary fs-6">agent_user</span>
            <span class="badge bg-dark fs-6">viewer</span>
        </div>
    </div>
</div>

<hr class="my-5">

<h2 id="analytics">Execution Analytics</h2>
<div class="row align-items-center mb-5">
    <div class="col-lg-6 order-lg-2">
        <p class="lead">Comprehensive analytics and monitoring dashboard.</p>
        <ul>
            <li>Real-time execution tracking</li>
            <li>Cost analysis by agent/workflow</li>
            <li>Performance metrics</li>
            <li>Error rate monitoring</li>
            <li>Usage trends</li>
        </ul>
    </div>
    <div class="col-lg-6 order-lg-1">
        <div class="card">
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-4">
                        <h4 class="text-success">98.5%</h4>
                        <small class="text-muted">Success Rate</small>
                    </div>
                    <div class="col-4">
                        <h4 class="text-primary">1.2s</h4>
                        <small class="text-muted">Avg Latency</small>
                    </div>
                    <div class="col-4">
                        <h4 class="text-warning">$0.04</h4>
                        <small class="text-muted">Avg Cost</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<hr class="my-5">

<h2 id="ai-organizations">AI Organizations <span class="badge bg-info">v1.4.8</span></h2>
<div class="row align-items-center mb-5">
    <div class="col-lg-6">
        <p class="lead">Create AI-powered digital twins of organizational structures with hierarchical task delegation.</p>
        <ul>
            <li><strong>Hierarchical Structure:</strong> Model real org charts with CEO → Managers → Analysts</li>
            <li><strong>Visual Org Designer:</strong> Drag-and-drop interface for building AI hierarchies</li>
            <li><strong>Task Delegation:</strong> Parent nodes delegate subtasks to subordinates</li>
            <li><strong>Response Aggregation:</strong> AI synthesizes subordinate responses at each level</li>
            <li><strong>Human Mirror:</strong> Each AI node represents a real employee</li>
            <li><strong>Node Types:</strong> Executive, Manager, Analyst, Coordinator</li>
            <li><strong>Delegation Strategies:</strong> Parallel, Sequential, Conditional</li>
            <li><strong>HITL Integration:</strong> Human approval at any level of the hierarchy</li>
        </ul>
        <a href="{{ url_for('help_page', page='aiorg') }}" class="btn btn-outline-primary btn-sm">View AI Org Documentation</a>
    </div>
    <div class="col-lg-6">
        <pre><code class="language-text">┌─────────────────────────────────────┐
│         AI ORGANIZATION             │
├─────────────────────────────────────┤
│          ┌─────────┐                │
│          │   CEO   │ ← Task         │
│          │  GPT-4  │                │
│          └────┬────┘                │
│               │ Delegates           │
│       ┌───────┴───────┐             │
│       │               │             │
│  ┌────┴────┐    ┌────┴────┐        │
│  │VP Research│  │VP Finance│        │
│  │ (Manager) │  │ (Manager)│        │
│  └────┬────┘    └────┬────┘        │
│       │               │             │
│  ┌────┴────┐    ┌────┴────┐        │
│  │ Analyst │    │ Analyst │        │
│  └─────────┘    └─────────┘        │
│                                     │
│  Response flows UP the hierarchy    │
└─────────────────────────────────────┘</code></pre>
    </div>
</div>

<hr class="my-5">

<h2 id="notifications">Enterprise Notifications <span class="badge bg-warning text-dark">v1.4.0</span></h2>
<div class="row align-items-center mb-5">
    <div class="col-lg-6 order-lg-2">
        <p class="lead">Unified multi-channel notification system for agents, workflows, and AI organizations.</p>
        <ul>
            <li><strong>Slack Integration:</strong> Channel messages, DMs, Block Kit formatting, thread replies</li>
            <li><strong>Microsoft Teams:</strong> Incoming webhooks, Adaptive Cards, action buttons</li>
            <li><strong>Email:</strong> SMTP integration with HTML templates</li>
            <li><strong>Custom Webhooks:</strong> Send to any HTTP endpoint</li>
            <li><strong>Rate Limiting:</strong> Token bucket algorithm prevents overwhelming services</li>
            <li><strong>Retry Logic:</strong> Exponential backoff for failed deliveries</li>
            <li><strong>Audit Logging:</strong> Complete notification history</li>
        </ul>
        <a href="{{ url_for('help_page', page='notifications') }}" class="btn btn-outline-info btn-sm">View Notification Guide</a>
    </div>
    <div class="col-lg-6 order-lg-1">
        <pre><code class="language-python">from abhikarta.notification import NotificationManager

manager = NotificationManager()

# Send to Slack channel
await manager.send(
    channel_id="slack-general",
    title="Task Completed",
    message="Analysis complete",
    level="success"
)

# Notify human mirror in AI Org
await manager.notify_human_mirror(
    node=ceo_node,
    event="task_completed",
    task=task
)</code></pre>
    </div>
</div>

<div class="text-center mt-5">
    <a href="{{ url_for('about') }}" class="btn btn-outline-primary">
        <i class="bi bi-arrow-left me-2"></i>Back to About
    </a>
</div>
{% endblock %}
