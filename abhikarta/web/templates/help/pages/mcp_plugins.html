{% extends "help/help_base.html" %}

{% set title = "MCP Plugins" %}
{% set description = "Connect external tools using Model Context Protocol" %}
{% set icon = "bi-plug" %}
{% set header_color = "#6c757d" %}
{% set header_color_dark = "#495057" %}

{% block help_nav %}
<a href="#overview">Overview</a>
<a href="#plugin-types">Plugin Types</a>
<a href="#http-plugins">HTTP Plugins</a>
<a href="#stdio-plugins">STDIO Plugins</a>
<a href="#creating-server">Creating MCP Server</a>
<a href="#workflow-usage">Using in Workflows</a>
<a href="#tool-discovery">Tool Discovery</a>
{% endblock %}

{% block help_content %}
<h2 id="overview">Overview</h2>
<p>The Model Context Protocol (MCP) allows you to extend agent capabilities by connecting to external tools and services.</p>

<hr class="my-5">

<h2 id="plugin-types">Plugin Types</h2>
<div class="row g-4 mb-4">
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-body">
                <h5><i class="bi bi-globe text-primary me-2"></i>HTTP/SSE Plugins</h5>
                <p>Connect to web-based MCP servers via HTTP with Server-Sent Events for streaming.</p>
                <ul>
                    <li>REST API endpoints</li>
                    <li>Real-time tool discovery</li>
                    <li>Streaming responses</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-body">
                <h5><i class="bi bi-terminal text-success me-2"></i>STDIO Plugins</h5>
                <p>Run local MCP servers as subprocesses with stdin/stdout communication.</p>
                <ul>
                    <li>Local execution</li>
                    <li>Python/Node servers</li>
                    <li>Full isolation</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<hr class="my-5">

<h2 id="http-plugins">Registering HTTP Plugin</h2>
<ol>
    <li>Navigate to <strong>Admin → MCP Plugins</strong></li>
    <li>Click <strong>"Add Plugin"</strong></li>
    <li>Configure:</li>
</ol>

<pre><code class="language-json">{
  "plugin_id": "weather-api",
  "name": "Weather API",
  "plugin_type": "http",
  "config": {
    "base_url": "http://localhost:8080",
    "headers": {
      "Authorization": "Bearer xxx"
    }
  }
}</code></pre>

<hr class="my-5">

<h2 id="stdio-plugins">STDIO Plugin Configuration</h2>
<pre><code class="language-json">{
  "plugin_id": "local-tools",
  "name": "Local Tools",
  "plugin_type": "stdio",
  "config": {
    "command": "python",
    "args": ["/path/to/mcp_server.py"],
    "env": {
      "API_KEY": "xxx"
    }
  }
}</code></pre>

<hr class="my-5">

<h2 id="creating-server">Creating an MCP Server</h2>
<h5>Python with FastMCP</h5>
<pre><code class="language-python">from fastmcp import FastMCP

mcp = FastMCP("Weather Service")

@mcp.tool()
def get_weather(city: str) -> str:
    """Get current weather for a city"""
    # Your weather API logic here
    return f"Weather in {city}: 72°F, Sunny"

@mcp.tool()
def get_forecast(city: str, days: int = 5) -> str:
    """Get weather forecast"""
    return f"{days}-day forecast for {city}..."

# Run with: uvicorn mcp_server:mcp.app --port 8080</code></pre>

<hr class="my-5">

<h2 id="workflow-usage">Using Plugins in Workflows</h2>
<pre><code class="language-json">{
  "type": "tool",
  "name": "Get Weather Data",
  "config": {
    "plugin_id": "weather-api",
    "tool_name": "get_weather",
    "arguments": {
      "city": "New York"
    }
  }
}</code></pre>

<hr class="my-5">

<h2 id="tool-discovery">Tool Discovery API</h2>
<pre><code class="language-bash">GET /api/mcp/plugins/weather-api/tools

# Response:
{
  "tools": [
    {
      "name": "get_weather",
      "description": "Get current weather for a city",
      "parameters": {
        "city": {"type": "string", "required": true}
      }
    },
    {
      "name": "get_forecast",
      "description": "Get weather forecast",
      "parameters": {
        "city": {"type": "string"},
        "days": {"type": "integer", "default": 5}
      }
    }
  ]
}</code></pre>
{% endblock %}
