{% extends "base.html" %}

{% block title %}Create Agent - {{ app_name }}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('user_dashboard') }}">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('agents_list') }}">Agents</a></li>
            <li class="breadcrumb-item active">Create Agent</li>
        </ol>
    </nav>

    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2><i class="bi bi-plus-circle me-2"></i>Create New Agent</h2>
            <p class="text-muted mb-0">Configure a new AI agent with tools and workflows</p>
        </div>
        <div>
            <a href="{{ url_for('agents_list') }}" class="btn btn-outline-secondary me-2">
                <i class="bi bi-arrow-left me-1"></i>Back to Agents
            </a>
            <a href="{{ url_for('new_agent_designer') }}" class="btn btn-outline-success">
                <i class="bi bi-diagram-3 me-1"></i>Visual Designer
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0"><i class="bi bi-gear me-2"></i>Agent Configuration</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('create_agent') }}">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label class="form-label">Agent Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" name="name" required
                                           placeholder="Enter agent name">
                                    <div class="form-text">A unique name for your agent</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Agent Type <span class="text-danger">*</span></label>
                                    <select class="form-select" name="agent_type" required>
                                        {% for type in agent_types %}
                                        <option value="{{ type.value }}">{{ type.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" name="description" rows="3"
                                      placeholder="Describe what this agent does"></textarea>
                        </div>

                        <hr class="my-4">
                        <h6><i class="bi bi-cpu me-2"></i>LLM Configuration</h6>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">LLM Provider</label>
                                    <select class="form-select" name="llm_provider" id="llm_provider">
                                        <option value="openai">OpenAI</option>
                                        <option value="anthropic">Anthropic</option>
                                        <option value="ollama">Ollama (Local)</option>
                                        <option value="bedrock">AWS Bedrock</option>
                                        <option value="azure">Azure OpenAI</option>
                                        <option value="google">Google Vertex AI</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Model</label>
                                    <input type="text" class="form-control" name="model" id="model"
                                           placeholder="e.g., gpt-4o" value="gpt-4o">
                                    <div class="form-text">Model identifier for the selected provider</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Temperature</label>
                                    <input type="number" class="form-control" name="temperature"
                                           min="0" max="2" step="0.1" value="0.7">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Max Tokens</label>
                                    <input type="number" class="form-control" name="max_tokens"
                                           min="100" max="128000" value="4096">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Max Iterations</label>
                                    <input type="number" class="form-control" name="max_iterations"
                                           min="1" max="50" value="10">
                                </div>
                            </div>
                        </div>

                        <hr class="my-4">
                        <h6><i class="bi bi-chat-left-text me-2"></i>System Prompt</h6>

                        <div class="mb-3">
                            <label class="form-label">System Message</label>
                            <textarea class="form-control font-monospace" name="system_prompt" rows="4"
                                      placeholder="You are a helpful AI assistant...">You are a helpful AI assistant. You help users accomplish their tasks efficiently and accurately.</textarea>
                            <div class="form-text">Instructions that guide the agent's behavior</div>
                        </div>

                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Tip:</strong> After creation, you can configure tools and advanced workflow settings in the Visual Designer or the agent's edit page.
                        </div>

                        <div class="d-flex justify-content-end gap-2 mt-4">
                            <a href="{{ url_for('agents_list') }}" class="btn btn-outline-secondary">Cancel</a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-plus-circle me-1"></i>Create Agent
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Quick Links -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white">
                    <h6 class="mb-0"><i class="bi bi-lightning me-2"></i>Quick Actions</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('new_agent_designer') }}" class="btn btn-outline-success">
                            <i class="bi bi-diagram-3 me-1"></i>Use Visual Designer
                        </a>
                        <a href="{{ url_for('agent_templates') }}" class="btn btn-outline-primary">
                            <i class="bi bi-collection me-1"></i>Start from Template
                        </a>
                    </div>
                </div>
            </div>

            <!-- Agent Types Info -->
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h6 class="mb-0"><i class="bi bi-info-circle me-2"></i>Agent Types</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong>ReAct</strong>
                        <p class="small text-muted mb-0">Reasoning and Acting - iteratively reasons about actions and observes results</p>
                    </div>
                    <div class="mb-3">
                        <strong>Chain of Thought</strong>
                        <p class="small text-muted mb-0">Step-by-step reasoning through complex problems</p>
                    </div>
                    <div class="mb-3">
                        <strong>Plan and Execute</strong>
                        <p class="small text-muted mb-0">Creates a plan first, then executes each step</p>
                    </div>
                    <div class="mb-0">
                        <strong>Custom</strong>
                        <p class="small text-muted mb-0">Define your own agent logic with code</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Update model suggestions based on provider
    document.getElementById('llm_provider').addEventListener('change', function() {
        const modelInput = document.getElementById('model');
        const provider = this.value;
        
        const suggestions = {
            'openai': 'gpt-4o',
            'anthropic': 'claude-3-5-sonnet-20241022',
            'ollama': 'llama3.2',
            'bedrock': 'anthropic.claude-3-sonnet-20240229-v1:0',
            'azure': 'gpt-4o',
            'google': 'gemini-1.5-pro'
        };
        
        modelInput.value = suggestions[provider] || '';
    });
</script>
{% endblock %}

{% block page_glossary %}
<div class="container-fluid py-4 bg-light border-top">
    <div class="row">
        <div class="col-12">
            <h6 class="text-muted mb-3"><i class="bi bi-book me-2"></i>Key Terms on This Page</h6>
            <div class="row g-3">
                <div class="col-md-4">
                    <div class="card h-100 border-0 bg-white">
                        <div class="card-body py-2">
                            <strong class="text-primary">Agent</strong>
                            <p class="small text-muted mb-0">An autonomous AI entity combining LLMs with tools to perform tasks.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 border-0 bg-white">
                        <div class="card-body py-2">
                            <strong class="text-primary">Agent Type</strong>
                            <p class="small text-muted mb-0">Architecture pattern: ReAct, Chain of Thought, Plan & Execute, or Custom.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 border-0 bg-white">
                        <div class="card-body py-2">
                            <strong class="text-primary">System Prompt</strong>
                            <p class="small text-muted mb-0">Instructions defining the agent's role, behavior, and constraints.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 border-0 bg-white">
                        <div class="card-body py-2">
                            <strong class="text-primary">Temperature</strong>
                            <p class="small text-muted mb-0">Controls output randomness: lower = focused, higher = creative.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 border-0 bg-white">
                        <div class="card-body py-2">
                            <strong class="text-primary">Max Iterations</strong>
                            <p class="small text-muted mb-0">Maximum reasoning/action cycles before the agent stops.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 border-0 bg-white">
                        <div class="card-body py-2">
                            <strong class="text-primary">LLM Provider</strong>
                            <p class="small text-muted mb-0">Service hosting the language model (OpenAI, Anthropic, etc.).</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-center mt-3">
                <a href="{{ url_for('help_page', page='glossary') }}" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-book me-1"></i>View Full Glossary
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
