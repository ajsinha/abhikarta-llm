{
  "workflow_id": "banking_loan_application",
  "name": "Loan Application Processing Workflow",
  "description": "End-to-end loan application workflow that handles application intake, credit assessment, risk evaluation, and approval decision with human-in-the-loop for edge cases.",
  "version": "1.0.0",
  "category": "banking",
  "subcategory": "lending",
  "nodes": [
    {
      "id": "start",
      "type": "start",
      "name": "Application Received",
      "config": {},
      "position": {"x": 100, "y": 200}
    },
    {
      "id": "validate_application",
      "type": "tool",
      "name": "Validate Application",
      "config": {
        "tool_name": "validate_email",
        "description": "Validate applicant contact information"
      },
      "position": {"x": 300, "y": 200}
    },
    {
      "id": "credit_check",
      "type": "agent",
      "name": "Credit Assessment",
      "config": {
        "agent_id": "banking_credit_risk",
        "prompt": "Perform credit assessment for loan application. Analyze credit history, calculate credit score, and determine risk tier."
      },
      "position": {"x": 500, "y": 200}
    },
    {
      "id": "dti_calculation",
      "type": "tool",
      "name": "Calculate DTI",
      "config": {
        "tool_name": "assess_debt_to_income",
        "description": "Calculate debt-to-income ratio"
      },
      "position": {"x": 700, "y": 200}
    },
    {
      "id": "eligibility_check",
      "type": "tool",
      "name": "Check Eligibility",
      "config": {
        "tool_name": "calculate_loan_eligibility",
        "description": "Determine loan eligibility based on all factors"
      },
      "position": {"x": 900, "y": 200}
    },
    {
      "id": "decision_router",
      "type": "condition",
      "name": "Route Decision",
      "config": {
        "condition": "eligibility_score >= 80",
        "description": "Route based on eligibility score"
      },
      "position": {"x": 1100, "y": 200}
    },
    {
      "id": "auto_approve",
      "type": "llm",
      "name": "Auto Approve",
      "config": {
        "model_id": "gpt-4o",
        "prompt": "Generate loan approval letter with terms and conditions for the approved application.",
        "temperature": 0.3
      },
      "position": {"x": 1300, "y": 100}
    },
    {
      "id": "hitl_review",
      "type": "hitl",
      "name": "Manual Review Required",
      "config": {
        "task_type": "loan_review",
        "priority": "high",
        "description": "Application requires manual review by loan officer"
      },
      "position": {"x": 1300, "y": 300}
    },
    {
      "id": "generate_schedule",
      "type": "tool",
      "name": "Generate Amortization",
      "config": {
        "tool_name": "generate_amortization_schedule",
        "description": "Generate payment schedule for approved loan"
      },
      "position": {"x": 1500, "y": 100}
    },
    {
      "id": "decline_notification",
      "type": "llm",
      "name": "Generate Decline Letter",
      "config": {
        "model_id": "gpt-4o",
        "prompt": "Generate a professional and empathetic decline letter explaining the decision and providing guidance for future applications.",
        "temperature": 0.4
      },
      "position": {"x": 1300, "y": 500}
    },
    {
      "id": "merge_results",
      "type": "passthrough",
      "name": "Merge Results",
      "config": {},
      "position": {"x": 1700, "y": 200}
    },
    {
      "id": "end",
      "type": "end",
      "name": "Process Complete",
      "config": {},
      "position": {"x": 1900, "y": 200}
    }
  ],
  "edges": [
    {"from": "start", "to": "validate_application"},
    {"from": "validate_application", "to": "credit_check"},
    {"from": "credit_check", "to": "dti_calculation"},
    {"from": "dti_calculation", "to": "eligibility_check"},
    {"from": "eligibility_check", "to": "decision_router"},
    {"from": "decision_router", "to": "auto_approve", "condition": "score >= 80"},
    {"from": "decision_router", "to": "hitl_review", "condition": "40 <= score < 80"},
    {"from": "decision_router", "to": "decline_notification", "condition": "score < 40"},
    {"from": "auto_approve", "to": "generate_schedule"},
    {"from": "hitl_review", "to": "merge_results"},
    {"from": "generate_schedule", "to": "merge_results"},
    {"from": "decline_notification", "to": "merge_results"},
    {"from": "merge_results", "to": "end"}
  ],
  "input_schema": {
    "type": "object",
    "properties": {
      "applicant": {
        "type": "object",
        "properties": {
          "name": {"type": "string"},
          "email": {"type": "string"},
          "phone": {"type": "string"},
          "ssn": {"type": "string"}
        }
      },
      "loan_details": {
        "type": "object",
        "properties": {
          "type": {"type": "string"},
          "amount": {"type": "number"},
          "term_months": {"type": "number"},
          "purpose": {"type": "string"}
        }
      },
      "financial_info": {
        "type": "object",
        "properties": {
          "monthly_income": {"type": "number"},
          "employment_years": {"type": "number"},
          "existing_debts": {"type": "object"}
        }
      },
      "credit_info": {
        "type": "object",
        "properties": {
          "credit_score": {"type": "number"},
          "credit_history_years": {"type": "number"}
        }
      }
    }
  },
  "output_schema": {
    "type": "object",
    "properties": {
      "application_id": {"type": "string"},
      "decision": {"type": "string"},
      "approved_amount": {"type": "number"},
      "interest_rate": {"type": "number"},
      "monthly_payment": {"type": "number"},
      "decision_letter": {"type": "string"}
    }
  },
  "tags": ["loan", "application", "credit", "workflow", "banking"],
  "permissions": {
    "allowed_roles": ["agent_developer", "super_admin", "domain_admin"]
  },
  "status": "published",
  "created_at": "2025-01-01T00:00:00Z",
  "author": "Abhikarta System"
}
