{
  "workflow_id": "banking_dispute_resolution",
  "name": "Account Dispute Resolution Workflow",
  "description": "Complete workflow for handling customer disputes including transaction disputes, unauthorized charges, and billing errors with regulatory compliance.",
  "version": "1.0.0",
  "category": "banking",
  "subcategory": "customer_service",
  "nodes": [
    {
      "id": "start",
      "type": "start",
      "name": "Dispute Filed",
      "config": {},
      "position": {"x": 100, "y": 300}
    },
    {
      "id": "validate_dispute",
      "type": "code",
      "name": "Validate Dispute Details",
      "config": {
        "language": "python",
        "code": "required = ['customer_id', 'transaction_id', 'dispute_type', 'description']\nmissing = [f for f in required if not input_data.get(f)]\nresult = {'valid': len(missing) == 0, 'missing': missing, 'dispute_id': f\"DSP-{input_data.get('transaction_id', 'UNK')[:8]}\"}"
      },
      "position": {"x": 300, "y": 300}
    },
    {
      "id": "classify_dispute",
      "type": "llm",
      "name": "Classify Dispute Type",
      "config": {
        "model_id": "gpt-4o",
        "prompt": "Classify this dispute into one of these categories based on the description:\n- UNAUTHORIZED: Unauthorized transaction or fraud\n- BILLING_ERROR: Incorrect amount or duplicate charge\n- MERCHANT_DISPUTE: Issue with merchant/goods/services\n- ATM_ISSUE: ATM-related problem\n- OTHER: Other dispute type\n\nAlso determine priority (high/medium/low) based on amount and customer impact.",
        "temperature": 0.2
      },
      "position": {"x": 500, "y": 300}
    },
    {
      "id": "check_regulation_e",
      "type": "code",
      "name": "Check Reg E Timeline",
      "config": {
        "language": "python",
        "code": "from datetime import datetime, timedelta\ntransaction_date = input_data.get('transaction_date', '')\ntry:\n    tx_date = datetime.strptime(transaction_date, '%Y-%m-%d')\n    days_elapsed = (datetime.now() - tx_date).days\n    within_60_days = days_elapsed <= 60\n    provisional_credit_required = days_elapsed <= 10\n    result = {'within_reg_e_window': within_60_days, 'days_elapsed': days_elapsed, 'provisional_credit_deadline': provisional_credit_required}\nexcept:\n    result = {'error': 'Invalid transaction date'}"
      },
      "position": {"x": 700, "y": 300}
    },
    {
      "id": "fraud_check",
      "type": "agent",
      "name": "Fraud Analysis",
      "config": {
        "agent_id": "banking_fraud_detection",
        "prompt": "Analyze this disputed transaction for fraud indicators. Check if this appears to be legitimate unauthorized activity or potential friendly fraud."
      },
      "position": {"x": 900, "y": 200}
    },
    {
      "id": "transaction_analysis",
      "type": "tool",
      "name": "Analyze Transaction",
      "config": {
        "tool_name": "analyze_transaction"
      },
      "position": {"x": 900, "y": 400}
    },
    {
      "id": "merge_analysis",
      "type": "passthrough",
      "name": "Merge Analysis",
      "config": {},
      "position": {"x": 1100, "y": 300}
    },
    {
      "id": "decision_router",
      "type": "condition",
      "name": "Resolution Router",
      "config": {
        "condition": "auto_resolve_eligible",
        "description": "Route based on auto-resolution eligibility"
      },
      "position": {"x": 1300, "y": 300}
    },
    {
      "id": "auto_resolve",
      "type": "code",
      "name": "Auto Resolve",
      "config": {
        "language": "python",
        "code": "result = {\n  'resolution': 'auto_approved',\n  'credit_amount': input_data.get('disputed_amount', 0),\n  'provisional': True,\n  'resolution_date': datetime.now().isoformat()\n}"
      },
      "position": {"x": 1500, "y": 200}
    },
    {
      "id": "hitl_review",
      "type": "hitl",
      "name": "Manual Review",
      "config": {
        "task_type": "dispute_review",
        "priority": "high",
        "description": "Dispute requires manual investigation and resolution"
      },
      "position": {"x": 1500, "y": 400}
    },
    {
      "id": "generate_letter",
      "type": "llm",
      "name": "Generate Resolution Letter",
      "config": {
        "model_id": "gpt-4o",
        "prompt": "Generate a professional dispute resolution letter including:\n- Dispute reference number\n- Resolution decision\n- Credit/debit details if applicable\n- Timeline of investigation\n- Customer rights under Regulation E\n- Contact information for further questions",
        "temperature": 0.3
      },
      "position": {"x": 1700, "y": 300}
    },
    {
      "id": "send_notification",
      "type": "tool",
      "name": "Send Notification",
      "config": {
        "tool_name": "create_notification"
      },
      "position": {"x": 1900, "y": 300}
    },
    {
      "id": "end",
      "type": "end",
      "name": "Dispute Closed",
      "config": {},
      "position": {"x": 2100, "y": 300}
    }
  ],
  "edges": [
    {"from": "start", "to": "validate_dispute"},
    {"from": "validate_dispute", "to": "classify_dispute"},
    {"from": "classify_dispute", "to": "check_regulation_e"},
    {"from": "check_regulation_e", "to": "fraud_check"},
    {"from": "check_regulation_e", "to": "transaction_analysis"},
    {"from": "fraud_check", "to": "merge_analysis"},
    {"from": "transaction_analysis", "to": "merge_analysis"},
    {"from": "merge_analysis", "to": "decision_router"},
    {"from": "decision_router", "to": "auto_resolve", "condition": "eligible"},
    {"from": "decision_router", "to": "hitl_review", "condition": "manual"},
    {"from": "auto_resolve", "to": "generate_letter"},
    {"from": "hitl_review", "to": "generate_letter"},
    {"from": "generate_letter", "to": "send_notification"},
    {"from": "send_notification", "to": "end"}
  ],
  "input_schema": {
    "type": "object",
    "properties": {
      "customer_id": {"type": "string"},
      "transaction_id": {"type": "string"},
      "transaction_date": {"type": "string"},
      "disputed_amount": {"type": "number"},
      "dispute_type": {"type": "string"},
      "description": {"type": "string"},
      "supporting_documents": {"type": "array"}
    },
    "required": ["customer_id", "transaction_id", "disputed_amount", "description"]
  },
  "tags": ["dispute", "regulation_e", "customer_service", "banking"],
  "permissions": {
    "allowed_roles": ["agent_developer", "super_admin", "domain_admin"]
  },
  "status": "published",
  "created_at": "2025-01-01T00:00:00Z",
  "author": "Abhikarta System"
}
