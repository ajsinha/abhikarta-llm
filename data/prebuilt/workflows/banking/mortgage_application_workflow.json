{
  "workflow_id": "banking_mortgage_application",
  "name": "Mortgage Application Workflow",
  "description": "Comprehensive mortgage application workflow including property valuation, income verification, underwriting, and closing coordination.",
  "version": "1.0.0",
  "category": "banking",
  "subcategory": "lending",
  "nodes": [
    {
      "id": "start",
      "type": "start",
      "name": "Application Submitted",
      "config": {},
      "position": {"x": 100, "y": 300}
    },
    {
      "id": "prequalification",
      "type": "agent",
      "name": "Pre-qualification Check",
      "config": {
        "agent_id": "banking_loan_processor",
        "prompt": "Perform initial pre-qualification for mortgage application. Check basic eligibility criteria including credit score minimums and income requirements."
      },
      "position": {"x": 300, "y": 300}
    },
    {
      "id": "credit_assessment",
      "type": "tool",
      "name": "Credit Assessment",
      "config": {
        "tool_name": "calculate_credit_score"
      },
      "position": {"x": 500, "y": 300}
    },
    {
      "id": "dti_calculation",
      "type": "tool",
      "name": "Calculate DTI",
      "config": {
        "tool_name": "assess_debt_to_income"
      },
      "position": {"x": 700, "y": 300}
    },
    {
      "id": "income_verification",
      "type": "hitl",
      "name": "Income Verification",
      "config": {
        "task_type": "document_verification",
        "priority": "medium",
        "description": "Verify income documents: W-2s, tax returns, pay stubs"
      },
      "position": {"x": 900, "y": 300}
    },
    {
      "id": "property_valuation",
      "type": "hitl",
      "name": "Property Appraisal",
      "config": {
        "task_type": "property_appraisal",
        "priority": "high",
        "description": "Order and review property appraisal report"
      },
      "position": {"x": 1100, "y": 300}
    },
    {
      "id": "ltv_calculation",
      "type": "code",
      "name": "Calculate LTV",
      "config": {
        "language": "python",
        "code": "loan_amount = input_data.get('loan_amount', 0)\nproperty_value = input_data.get('property_value', 1)\nltv = (loan_amount / property_value) * 100\nresult = {\n  'ltv_ratio': round(ltv, 2),\n  'pmi_required': ltv > 80,\n  'max_ltv_exceeded': ltv > 97\n}"
      },
      "position": {"x": 1300, "y": 300}
    },
    {
      "id": "underwriting",
      "type": "agent",
      "name": "Underwriting Decision",
      "config": {
        "agent_id": "banking_credit_risk",
        "prompt": "Perform final underwriting analysis. Consider all factors: credit score, DTI, LTV, property value, income stability. Provide clear approval, conditional approval, or denial decision."
      },
      "position": {"x": 1500, "y": 300}
    },
    {
      "id": "decision_router",
      "type": "condition",
      "name": "Decision Router",
      "config": {
        "condition": "underwriting_decision",
        "description": "Route based on underwriting decision"
      },
      "position": {"x": 1700, "y": 300}
    },
    {
      "id": "generate_commitment",
      "type": "llm",
      "name": "Generate Commitment Letter",
      "config": {
        "model_id": "gpt-4o",
        "prompt": "Generate a formal mortgage commitment letter including:\n- Approved loan amount\n- Interest rate and type\n- Loan term\n- Estimated monthly payment\n- Conditions to close\n- Expiration date",
        "temperature": 0.3
      },
      "position": {"x": 1900, "y": 200}
    },
    {
      "id": "schedule_closing",
      "type": "code",
      "name": "Schedule Closing",
      "config": {
        "language": "python",
        "code": "from datetime import datetime, timedelta\nclosing_date = datetime.now() + timedelta(days=30)\nresult = {\n  'closing_date': closing_date.strftime('%Y-%m-%d'),\n  'closing_location': 'To be determined',\n  'documents_required': ['ID', 'Proof of insurance', 'Final walkthrough']\n}"
      },
      "position": {"x": 2100, "y": 200}
    },
    {
      "id": "decline_letter",
      "type": "llm",
      "name": "Generate Adverse Action Notice",
      "config": {
        "model_id": "gpt-4o",
        "prompt": "Generate an adverse action notice for a declined mortgage application. Include specific reasons for denial and information about the applicant's rights.",
        "temperature": 0.3
      },
      "position": {"x": 1900, "y": 400}
    },
    {
      "id": "end",
      "type": "end",
      "name": "Process Complete",
      "config": {},
      "position": {"x": 2300, "y": 300}
    }
  ],
  "edges": [
    {"from": "start", "to": "prequalification"},
    {"from": "prequalification", "to": "credit_assessment"},
    {"from": "credit_assessment", "to": "dti_calculation"},
    {"from": "dti_calculation", "to": "income_verification"},
    {"from": "income_verification", "to": "property_valuation"},
    {"from": "property_valuation", "to": "ltv_calculation"},
    {"from": "ltv_calculation", "to": "underwriting"},
    {"from": "underwriting", "to": "decision_router"},
    {"from": "decision_router", "to": "generate_commitment", "condition": "approved"},
    {"from": "decision_router", "to": "decline_letter", "condition": "declined"},
    {"from": "generate_commitment", "to": "schedule_closing"},
    {"from": "schedule_closing", "to": "end"},
    {"from": "decline_letter", "to": "end"}
  ],
  "input_schema": {
    "type": "object",
    "properties": {
      "applicant": {"type": "object"},
      "co_applicant": {"type": "object"},
      "property": {
        "type": "object",
        "properties": {
          "address": {"type": "string"},
          "type": {"type": "string"},
          "purchase_price": {"type": "number"}
        }
      },
      "loan_details": {
        "type": "object",
        "properties": {
          "amount": {"type": "number"},
          "down_payment": {"type": "number"},
          "term_years": {"type": "number"},
          "type": {"type": "string"}
        }
      },
      "financial_info": {"type": "object"}
    }
  },
  "tags": ["mortgage", "home_loan", "underwriting", "real_estate", "banking"],
  "permissions": {
    "allowed_roles": ["agent_developer", "super_admin", "domain_admin"]
  },
  "status": "published",
  "created_at": "2025-01-01T00:00:00Z",
  "author": "Abhikarta System"
}
