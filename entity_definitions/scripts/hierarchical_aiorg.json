{
    "template_id": "script_hierarchical_aiorg",
    "name": "Hierarchical Project Team",
    "description": "A hierarchical AI organization with executives, managers, and specialists",
    "entity_type": "aiorg",
    "category": "organization",
    "difficulty": "advanced",
    "icon": "bi-building",
    "tags": [
        "aiorg",
        "hierarchy",
        "delegation",
        "hitl"
    ],
    "use_count": 0,
    "script_content": "\"\"\"\nHierarchical Project Team - Python Script Mode\n===============================================\nAI organization with hierarchical delegation.\n\"\"\"\n\nfrom typing import Dict, List, Any, Optional\nfrom dataclasses import dataclass, field\nfrom enum import Enum\nfrom abc import ABC, abstractmethod\nimport uuid\n\n\nclass RoleType(Enum):\n    EXECUTIVE = \"executive\"\n    MANAGER = \"manager\"\n    SPECIALIST = \"specialist\"\n    ANALYST = \"analyst\"\n\n\nclass DelegationStrategy(Enum):\n    ROUND_ROBIN = \"round_robin\"\n    LOAD_BALANCED = \"load_balanced\"\n    SKILL_BASED = \"skill_based\"\n\n\nclass TaskPriority(Enum):\n    CRITICAL = 1\n    HIGH = 2\n    MEDIUM = 3\n    LOW = 4\n\n\nclass TaskStatus(Enum):\n    CREATED = \"created\"\n    ASSIGNED = \"assigned\"\n    IN_PROGRESS = \"in_progress\"\n    AWAITING_APPROVAL = \"awaiting_approval\"\n    COMPLETED = \"completed\"\n\n\n@dataclass\nclass HITLConfig:\n    enabled: bool = True\n    approval_required: bool = False\n    timeout_hours: int = 24\n    \n    def to_dict(self) -> Dict[str, Any]:\n        return {\n            \"enabled\": self.enabled,\n            \"approval_required\": self.approval_required,\n            \"timeout_hours\": self.timeout_hours\n        }\n\n\n@dataclass\nclass OrgTask:\n    task_id: str\n    title: str\n    description: str\n    priority: TaskPriority\n    status: TaskStatus = TaskStatus.CREATED\n    assigned_to: Optional[str] = None\n    result: Any = None\n    \n    @classmethod\n    def create(cls, title: str, description: str, \n               priority: TaskPriority = TaskPriority.MEDIUM) -> 'OrgTask':\n        return cls(str(uuid.uuid4())[:8], title, description, priority)\n    \n    def to_dict(self) -> Dict[str, Any]:\n        return {\n            \"task_id\": self.task_id,\n            \"title\": self.title,\n            \"priority\": self.priority.value,\n            \"status\": self.status.value,\n            \"assigned_to\": self.assigned_to,\n            \"result\": str(self.result)[:100] if self.result else None\n        }\n\n\n@dataclass\nclass OrgNode:\n    node_id: str\n    role_name: str\n    role_type: RoleType\n    description: str\n    parent_node_id: Optional[str] = None\n    skills: List[str] = field(default_factory=list)\n    delegation_strategy: DelegationStrategy = DelegationStrategy.ROUND_ROBIN\n    hitl_config: HITLConfig = field(default_factory=HITLConfig)\n    active_tasks: int = 0\n    completed_tasks: int = 0\n    \n    def to_dict(self) -> Dict[str, Any]:\n        return {\n            \"node_id\": self.node_id,\n            \"role_name\": self.role_name,\n            \"role_type\": self.role_type.value,\n            \"description\": self.description,\n            \"parent_node_id\": self.parent_node_id,\n            \"skills\": self.skills,\n            \"delegation_strategy\": self.delegation_strategy.value,\n            \"hitl_config\": self.hitl_config.to_dict()\n        }\n\n\nclass OrgNodeAgent(ABC):\n    def __init__(self, node: OrgNode):\n        self.node = node\n        self.subordinates: List['OrgNodeAgent'] = []\n    \n    def add_subordinate(self, sub: 'OrgNodeAgent'):\n        self.subordinates.append(sub)\n    \n    @abstractmethod\n    def process_task(self, task: OrgTask) -> Dict[str, Any]:\n        pass\n    \n    def delegate_task(self, task: OrgTask) -> Optional['OrgNodeAgent']:\n        if not self.subordinates:\n            return None\n        \n        strategy = self.node.delegation_strategy\n        if strategy == DelegationStrategy.ROUND_ROBIN:\n            idx = self.node.completed_tasks % len(self.subordinates)\n            return self.subordinates[idx]\n        elif strategy == DelegationStrategy.LOAD_BALANCED:\n            return min(self.subordinates, key=lambda s: s.node.active_tasks)\n        elif strategy == DelegationStrategy.SKILL_BASED:\n            keywords = task.description.lower().split()\n            for sub in self.subordinates:\n                if any(skill.lower() in keywords for skill in sub.node.skills):\n                    return sub\n        return self.subordinates[0]\n\n\nclass ExecutiveNode(OrgNodeAgent):\n    def process_task(self, task: OrgTask) -> Dict[str, Any]:\n        self.node.active_tasks += 1\n        \n        if self.node.hitl_config.approval_required:\n            task.status = TaskStatus.AWAITING_APPROVAL\n            return {\"status\": \"awaiting_approval\", \"task\": task.to_dict()}\n        \n        delegate_to = self.delegate_task(task)\n        if delegate_to:\n            task.assigned_to = delegate_to.node.node_id\n            task.status = TaskStatus.ASSIGNED\n            result = delegate_to.process_task(task)\n            self.node.active_tasks -= 1\n            self.node.completed_tasks += 1\n            return result\n        \n        task.status = TaskStatus.COMPLETED\n        task.result = f\"Executive: {task.title}\"\n        self.node.active_tasks -= 1\n        self.node.completed_tasks += 1\n        return {\"status\": \"completed\", \"task\": task.to_dict()}\n\n\nclass ManagerNode(OrgNodeAgent):\n    def process_task(self, task: OrgTask) -> Dict[str, Any]:\n        self.node.active_tasks += 1\n        task.status = TaskStatus.IN_PROGRESS\n        \n        delegate_to = self.delegate_task(task)\n        if delegate_to:\n            task.assigned_to = delegate_to.node.node_id\n            result = delegate_to.process_task(task)\n            self.node.active_tasks -= 1\n            self.node.completed_tasks += 1\n            return result\n        \n        task.status = TaskStatus.COMPLETED\n        task.result = f\"Manager: {task.title}\"\n        self.node.active_tasks -= 1\n        self.node.completed_tasks += 1\n        return {\"status\": \"completed\", \"task\": task.to_dict()}\n\n\nclass SpecialistNode(OrgNodeAgent):\n    def process_task(self, task: OrgTask) -> Dict[str, Any]:\n        self.node.active_tasks += 1\n        task.status = TaskStatus.IN_PROGRESS\n        \n        task.result = f\"Specialist '{self.node.role_name}': {task.title}\"\n        task.status = TaskStatus.COMPLETED\n        \n        self.node.active_tasks -= 1\n        self.node.completed_tasks += 1\n        return {\n            \"status\": \"completed\",\n            \"task\": task.to_dict(),\n            \"executed_by\": self.node.role_name\n        }\n\n\nclass OrganizationManager:\n    def __init__(self):\n        self.nodes: Dict[str, OrgNode] = {}\n        self.agents: Dict[str, OrgNodeAgent] = {}\n        self.tasks: Dict[str, OrgTask] = {}\n        self.root_node_id: Optional[str] = None\n    \n    def add_node(self, node: OrgNode) -> str:\n        self.nodes[node.node_id] = node\n        \n        agent_map = {\n            RoleType.EXECUTIVE: ExecutiveNode,\n            RoleType.MANAGER: ManagerNode,\n            RoleType.SPECIALIST: SpecialistNode,\n            RoleType.ANALYST: SpecialistNode\n        }\n        agent_class = agent_map.get(node.role_type, SpecialistNode)\n        agent = agent_class(node)\n        self.agents[node.node_id] = agent\n        \n        if node.parent_node_id and node.parent_node_id in self.agents:\n            self.agents[node.parent_node_id].add_subordinate(agent)\n        \n        return node.node_id\n    \n    def set_root(self, node_id: str):\n        self.root_node_id = node_id\n    \n    def submit_task(self, title: str, description: str,\n                    priority: TaskPriority = TaskPriority.MEDIUM) -> OrgTask:\n        task = OrgTask.create(title, description, priority)\n        self.tasks[task.task_id] = task\n        return task\n    \n    def route_task(self, task: OrgTask, target: str = None) -> Dict:\n        target = target or self.root_node_id\n        if target not in self.agents:\n            return {\"error\": \"Node not found\"}\n        return self.agents[target].process_task(task)\n    \n    def get_structure(self) -> Dict:\n        return {\n            \"root_node_id\": self.root_node_id,\n            \"nodes\": [n.to_dict() for n in self.nodes.values()],\n            \"total_nodes\": len(self.nodes)\n        }\n\n\n# Node definitions\ndirector = OrgNode(\"director\", \"Project Director\", RoleType.EXECUTIVE,\n                   \"Strategic oversight\", delegation_strategy=DelegationStrategy.SKILL_BASED,\n                   hitl_config=HITLConfig(True, True))\n\ntech_manager = OrgNode(\"tech_manager\", \"Technical Manager\", RoleType.MANAGER,\n                       \"Manages tech team\", parent_node_id=\"director\",\n                       skills=[\"technical\", \"development\"],\n                       delegation_strategy=DelegationStrategy.SKILL_BASED)\n\nops_manager = OrgNode(\"ops_manager\", \"Operations Manager\", RoleType.MANAGER,\n                      \"Manages operations\", parent_node_id=\"director\",\n                      skills=[\"operations\", \"process\"],\n                      delegation_strategy=DelegationStrategy.LOAD_BALANCED)\n\ndeveloper = OrgNode(\"developer\", \"Developer\", RoleType.SPECIALIST,\n                    \"Development tasks\", parent_node_id=\"tech_manager\",\n                    skills=[\"coding\", \"implementation\"],\n                    hitl_config=HITLConfig(False))\n\nqa_specialist = OrgNode(\"qa_specialist\", \"QA Specialist\", RoleType.SPECIALIST,\n                        \"Quality assurance\", parent_node_id=\"tech_manager\",\n                        skills=[\"testing\", \"quality\"])\n\nanalyst = OrgNode(\"analyst\", \"Operations Analyst\", RoleType.ANALYST,\n                  \"Operations analysis\", parent_node_id=\"ops_manager\",\n                  skills=[\"analysis\", \"reporting\"])\n\nall_nodes = [director, tech_manager, ops_manager, developer, qa_specialist, analyst]\n\naiorg = {\n    \"name\": \"Hierarchical Project Team\",\n    \"description\": \"AI organization for project execution\",\n    \"version\": \"1.0.0\",\n    \"nodes\": [n.to_dict() for n in all_nodes],\n    \"root_node_id\": \"director\",\n    \"config\": {\n        \"default_delegation_strategy\": \"round_robin\",\n        \"max_delegation_depth\": 3\n    },\n    \"routing_rules\": [\n        {\"condition\": {\"type\": \"technical\"}, \"route_to\": \"tech_manager\"},\n        {\"condition\": {\"type\": \"operations\"}, \"route_to\": \"ops_manager\"},\n        {\"condition\": {\"priority\": \"critical\"}, \"route_to\": \"director\"}\n    ],\n    \"tags\": [\"hierarchical\", \"project\", \"python-script\"],\n    \"category\": \"organization\"\n}\n\n__export__ = aiorg\n\norg_manager = OrganizationManager()\nfor node in all_nodes:\n    org_manager.add_node(node)\norg_manager.set_root(\"director\")\n\n\ndef execute(input_data: Dict[str, Any]) -> Dict[str, Any]:\n    title = input_data.get(\"title\", input_data.get(\"prompt\", \"Task\"))\n    description = input_data.get(\"description\", title)\n    priority_str = input_data.get(\"priority\", \"medium\")\n    \n    priority_map = {\n        \"critical\": TaskPriority.CRITICAL,\n        \"high\": TaskPriority.HIGH,\n        \"medium\": TaskPriority.MEDIUM,\n        \"low\": TaskPriority.LOW\n    }\n    priority = priority_map.get(priority_str.lower(), TaskPriority.MEDIUM)\n    \n    task = org_manager.submit_task(title, description, priority)\n    result = org_manager.route_task(task)\n    \n    return {\n        \"success\": result.get(\"status\") == \"completed\",\n        \"response\": result,\n        \"org_structure\": org_manager.get_structure()\n    }\n\n\ndef validate() -> tuple:\n    if not aiorg.get(\"nodes\"):\n        return False, \"Organization must have nodes\"\n    if not aiorg.get(\"root_node_id\"):\n        return False, \"Organization must have a root node\"\n    return True, \"AI Organization configuration is valid\"\n"
}