{
    "template_id": "script_collaborative_swarm",
    "name": "Collaborative Task Team",
    "description": "An event-driven swarm with coordinated agents for collaborative task execution",
    "entity_type": "swarm",
    "category": "collaboration",
    "difficulty": "advanced",
    "icon": "bi-hive",
    "tags": [
        "swarm",
        "collaboration",
        "events",
        "coordination"
    ],
    "use_count": 0,
    "script_content": "\"\"\"\nCollaborative Task Team Swarm - Python Script Mode\n===================================================\nEvent-driven swarm with multiple specialized agents.\n\"\"\"\n\nfrom typing import Dict, List, Any, Optional, Callable\nfrom dataclasses import dataclass, field\nfrom enum import Enum\nfrom abc import ABC, abstractmethod\nimport uuid\nfrom datetime import datetime\n\n\nclass AgentRole(Enum):\n    COORDINATOR = \"coordinator\"\n    RESEARCHER = \"researcher\"\n    PROCESSOR = \"processor\"\n    REVIEWER = \"reviewer\"\n\n\nclass EventType(Enum):\n    TASK_CREATED = \"task_created\"\n    TASK_ASSIGNED = \"task_assigned\"\n    RESEARCH_COMPLETE = \"research_complete\"\n    PROCESSING_COMPLETE = \"processing_complete\"\n    REVIEW_COMPLETE = \"review_complete\"\n    TASK_COMPLETE = \"task_complete\"\n\n\nclass TaskStatus(Enum):\n    PENDING = \"pending\"\n    RESEARCHING = \"researching\"\n    PROCESSING = \"processing\"\n    REVIEWING = \"reviewing\"\n    COMPLETED = \"completed\"\n\n\n@dataclass\nclass Event:\n    event_id: str\n    event_type: EventType\n    source: str\n    payload: Dict[str, Any]\n    timestamp: str = \"\"\n    \n    @classmethod\n    def create(cls, event_type: EventType, source: str, payload: Dict) -> 'Event':\n        return cls(\n            str(uuid.uuid4())[:8], event_type, source, payload,\n            datetime.now().isoformat()\n        )\n    \n    def to_dict(self) -> Dict[str, Any]:\n        return {\n            \"event_id\": self.event_id,\n            \"event_type\": self.event_type.value,\n            \"source\": self.source,\n            \"payload\": self.payload\n        }\n\n\n@dataclass\nclass SwarmTask:\n    task_id: str\n    title: str\n    description: str\n    status: TaskStatus = TaskStatus.PENDING\n    data: Dict[str, Any] = field(default_factory=dict)\n    \n    @classmethod\n    def create(cls, title: str, description: str) -> 'SwarmTask':\n        return cls(str(uuid.uuid4())[:8], title, description)\n    \n    def to_dict(self) -> Dict[str, Any]:\n        return {\n            \"task_id\": self.task_id,\n            \"title\": self.title,\n            \"status\": self.status.value,\n            \"data\": self.data\n        }\n\n\n@dataclass\nclass AgentConfig:\n    agent_id: str\n    role: AgentRole\n    name: str\n    subscriptions: List[EventType]\n    publishes: List[EventType]\n    \n    def to_dict(self) -> Dict[str, Any]:\n        return {\n            \"agent_id\": self.agent_id,\n            \"role\": self.role.value,\n            \"name\": self.name,\n            \"subscriptions\": [s.value for s in self.subscriptions],\n            \"publishes\": [p.value for p in self.publishes]\n        }\n\n\nclass EventBus:\n    def __init__(self):\n        self.subscribers: Dict[EventType, List[Callable]] = {}\n        self.history: List[Event] = []\n    \n    def subscribe(self, event_type: EventType, handler: Callable):\n        if event_type not in self.subscribers:\n            self.subscribers[event_type] = []\n        self.subscribers[event_type].append(handler)\n    \n    def publish(self, event: Event):\n        self.history.append(event)\n        for handler in self.subscribers.get(event.event_type, []):\n            handler(event)\n    \n    def get_history(self) -> List[Dict]:\n        return [e.to_dict() for e in self.history]\n\n\nclass SwarmAgent(ABC):\n    def __init__(self, config: AgentConfig, event_bus: EventBus):\n        self.config = config\n        self.event_bus = event_bus\n        self.tasks_done = 0\n        for event_type in config.subscriptions:\n            event_bus.subscribe(event_type, self.handle_event)\n    \n    @abstractmethod\n    def handle_event(self, event: Event):\n        pass\n    \n    def publish(self, event_type: EventType, payload: Dict):\n        event = Event.create(event_type, self.config.agent_id, payload)\n        self.event_bus.publish(event)\n\n\nclass CoordinatorAgent(SwarmAgent):\n    def __init__(self, config: AgentConfig, event_bus: EventBus):\n        super().__init__(config, event_bus)\n        self.active_tasks: Dict[str, SwarmTask] = {}\n    \n    def handle_event(self, event: Event):\n        if event.event_type == EventType.TASK_CREATED:\n            task = SwarmTask.create(\n                event.payload.get(\"title\", \"Task\"),\n                event.payload.get(\"description\", \"\")\n            )\n            self.active_tasks[task.task_id] = task\n            self.publish(EventType.TASK_ASSIGNED, {\n                \"task\": task.to_dict(), \"assign_to\": \"researcher\"\n            })\n        elif event.event_type == EventType.REVIEW_COMPLETE:\n            task_id = event.payload.get(\"task_id\")\n            if task_id in self.active_tasks:\n                task = self.active_tasks[task_id]\n                task.status = TaskStatus.COMPLETED\n                task.data[\"result\"] = event.payload.get(\"result\")\n                self.publish(EventType.TASK_COMPLETE, {\"task\": task.to_dict()})\n                self.tasks_done += 1\n\n\nclass ResearcherAgent(SwarmAgent):\n    def handle_event(self, event: Event):\n        if event.event_type == EventType.TASK_ASSIGNED:\n            if event.payload.get(\"assign_to\") == \"researcher\":\n                task = event.payload.get(\"task\", {})\n                result = f\"Research: {task.get('title')}\"\n                self.publish(EventType.RESEARCH_COMPLETE, {\n                    \"task_id\": task.get(\"task_id\"), \"result\": result\n                })\n                self.tasks_done += 1\n\n\nclass ProcessorAgent(SwarmAgent):\n    def handle_event(self, event: Event):\n        if event.event_type == EventType.RESEARCH_COMPLETE:\n            task_id = event.payload.get(\"task_id\")\n            result = f\"Processed: {event.payload.get('result')}\"\n            self.publish(EventType.PROCESSING_COMPLETE, {\n                \"task_id\": task_id, \"result\": result\n            })\n            self.tasks_done += 1\n\n\nclass ReviewerAgent(SwarmAgent):\n    def handle_event(self, event: Event):\n        if event.event_type == EventType.PROCESSING_COMPLETE:\n            task_id = event.payload.get(\"task_id\")\n            result = f\"Reviewed: {event.payload.get('result')}\"\n            self.publish(EventType.REVIEW_COMPLETE, {\n                \"task_id\": task_id, \"result\": result, \"approved\": True\n            })\n            self.tasks_done += 1\n\n\nclass SwarmOrchestrator:\n    def __init__(self):\n        self.event_bus = EventBus()\n        self.agents: Dict[str, SwarmAgent] = {}\n        self.completed_tasks: List[SwarmTask] = []\n        self.event_bus.subscribe(EventType.TASK_COMPLETE, self._on_complete)\n    \n    def _on_complete(self, event: Event):\n        task_data = event.payload.get(\"task\", {})\n        task = SwarmTask(\n            task_data.get(\"task_id\"), task_data.get(\"title\"),\n            task_data.get(\"description\", \"\"), TaskStatus.COMPLETED,\n            task_data.get(\"data\", {})\n        )\n        self.completed_tasks.append(task)\n    \n    def add_agent(self, config: AgentConfig):\n        agent_map = {\n            AgentRole.COORDINATOR: CoordinatorAgent,\n            AgentRole.RESEARCHER: ResearcherAgent,\n            AgentRole.PROCESSOR: ProcessorAgent,\n            AgentRole.REVIEWER: ReviewerAgent\n        }\n        agent_class = agent_map.get(config.role)\n        if agent_class:\n            self.agents[config.agent_id] = agent_class(config, self.event_bus)\n    \n    def submit_task(self, title: str, description: str) -> str:\n        task_id = str(uuid.uuid4())[:8]\n        event = Event.create(EventType.TASK_CREATED, \"system\", {\n            \"task_id\": task_id, \"title\": title, \"description\": description\n        })\n        self.event_bus.publish(event)\n        return task_id\n    \n    def get_status(self) -> Dict:\n        return {\n            \"agents\": len(self.agents),\n            \"completed\": len(self.completed_tasks),\n            \"events\": len(self.event_bus.history)\n        }\n\n\n# Agent configs\nagent_configs = [\n    AgentConfig(\"coordinator\", AgentRole.COORDINATOR, \"Coordinator\",\n                [EventType.TASK_CREATED, EventType.REVIEW_COMPLETE],\n                [EventType.TASK_ASSIGNED, EventType.TASK_COMPLETE]),\n    AgentConfig(\"researcher\", AgentRole.RESEARCHER, \"Researcher\",\n                [EventType.TASK_ASSIGNED], [EventType.RESEARCH_COMPLETE]),\n    AgentConfig(\"processor\", AgentRole.PROCESSOR, \"Processor\",\n                [EventType.RESEARCH_COMPLETE], [EventType.PROCESSING_COMPLETE]),\n    AgentConfig(\"reviewer\", AgentRole.REVIEWER, \"Reviewer\",\n                [EventType.PROCESSING_COMPLETE], [EventType.REVIEW_COMPLETE])\n]\n\nswarm = {\n    \"name\": \"Collaborative Task Team\",\n    \"description\": \"Event-driven swarm for task execution\",\n    \"strategy\": \"event_driven\",\n    \"version\": \"1.0.0\",\n    \"agents\": [c.to_dict() for c in agent_configs],\n    \"config\": {\"max_concurrent_tasks\": 10},\n    \"tags\": [\"swarm\", \"collaboration\", \"python-script\"],\n    \"category\": \"collaboration\"\n}\n\n__export__ = swarm\n\norchestrator = SwarmOrchestrator()\nfor config in agent_configs:\n    orchestrator.add_agent(config)\n\n\ndef execute(input_data: Dict[str, Any]) -> Dict[str, Any]:\n    title = input_data.get(\"title\", input_data.get(\"prompt\", \"Task\"))\n    description = input_data.get(\"description\", title)\n    \n    task_id = orchestrator.submit_task(title, description)\n    \n    completed = None\n    for task in orchestrator.completed_tasks:\n        if task.task_id == task_id:\n            completed = task\n            break\n    \n    return {\n        \"success\": completed is not None,\n        \"response\": completed.data.get(\"result\") if completed else \"Processing\",\n        \"task_id\": task_id,\n        \"status\": orchestrator.get_status(),\n        \"events\": orchestrator.event_bus.get_history()[-5:]\n    }\n\n\ndef validate() -> tuple:\n    if not swarm.get(\"agents\"):\n        return False, \"Swarm must have agents\"\n    return True, \"Swarm configuration is valid\"\n"
}